{% extends 'base.html' %}

{% block content %}
<div class="container" style="margin-top: 30px;">
    <div class="card">
        <div class="card-header">
            <i class="fas fa-calculator"></i> نتيجة حساب المواريث - القضية رقم {{ case.case_number }}
        </div>
        <div style="padding: 20px;">

            <div class="row" style="display: flex; gap: 20px; margin-bottom: 30px;">
                <div class="col"
                    style="flex: 1; background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center;">
                    <h5>إجمالي الأصول</h5>
                    <h3 style="color: var(--primary-color);">{{ total_assets }} ريال</h3>
                </div>
                <div class="col"
                    style="flex: 1; background: #fff0f0; padding: 15px; border-radius: 5px; text-align: center;">
                    <h5>الديون</h5>
                    <h3 style="color: #dc3545;">{{ total_debts }} ريال</h3>
                </div>
                <div class="col"
                    style="flex: 1; background: #f0fff4; padding: 15px; border-radius: 5px; text-align: center;">
                    <h5>الوصايا (المخصومة)</h5>
                    <h3 style="color: #28a745;">{{ effective_wills }} ريال</h3>
                    <small>من إجمالي: {{ total_wills }}</small>
                </div>
                <div class="col"
                    style="flex: 1; background: var(--secondary-color); color: white; padding: 15px; border-radius: 5px; text-align: center;">
                    <h5>صافي التركة للتوزيع</h5>
                    <h3>{{ net_estate }} ريال</h3>
                </div>
            </div>

            <h4>توزيع الأنصبة</h4>
            <table style="width: 100%; margin-top: 15px; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                        <th style="padding: 10px;">الوريث</th>
                        <th style="padding: 10px;">القرابة</th>
                        <th style="padding: 10px;">النصيب الشرعي</th>
                        <th style="padding: 10px;">القيمة المالية</th>
                    </tr>
                </thead>
                <tbody>
                <tbody>
                    {% for item in results %}
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 10px;">{{ item.name }}</td>
                        <td style="padding: 10px;">{{ item.relationship }}</td>
                        <td style="padding: 10px;">
                            {% if item.fraction == 'Asabah' %}
                            عصبة
                            {% else %}
                            {{ item.fraction }}
                            {% endif %}
                        </td>
                        <td style="padding: 10px; font-weight: bold; color: var(--primary-color);">{{ item.value }}
                            ريال</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 20px;">لا يوجد ورثة مستحقين (تأكد من
                            البيانات)</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            {% if blocked_heirs %}
            <br>
            <h5 style="color: #dc3545; margin-top: 30px;">الورثة المحجوبين</h5>
            <table style="width: 100%; margin-top: 10px; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #fff0f0; border-bottom: 2px solid #ffcccc;">
                        <th style="padding: 10px;">الوريث</th>
                        <th style="padding: 10px;">القرابة</th>
                        <th style="padding: 10px;">سبب الحجب</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in blocked_heirs %}
                    <tr style="border-bottom: 1px solid #ffcccc;">
                        <td style="padding: 10px;">{{ item.name }}</td>
                        <td style="padding: 10px;">{{ item.relationship }}</td>
                        <td style="padding: 10px; color: #dc3545;">{{ item.blocking_reason }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <div style="margin-top: 30px; text-align: center;">
                <button onclick="window.print()" class="btn-primary">طباعة التقرير</button>
                <a href="{% url 'judges:allocate_assets' case.id %}" class="btn-primary"
                    style="background-color: var(--secondary-color);">
                    الانتقال لتوزيع التركة وتفعيل الجلسة
                </a>
                <a href="{% url 'judges:dashboard' %}" class="btn-primary" style="background-color: #6c757d;">عودة للوحة
                    التحكم</a>
            </div>

        </div>
    </div>
</div>
{% endblock %}